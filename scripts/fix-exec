#!/usr/bin/env bash
# fix-exec ‚Äî set executable bits on repo scripts and ~/bin (idempotent)

set -euo pipefail

# Resolve repo paths, following symlinks (works when called via ~/bin)
_self="${BASH_SOURCE[0]}"
while [[ -L "$_self" ]]; do
  _dir="$(cd "$(dirname "$_self")" && pwd)"
  _self="$(readlink "$_self")"
  [[ "$_self" != /* ]] && _self="$_dir/$_self"
done
BASE_DIR="$(cd "$(dirname "$_self")" && pwd)"
PROJECT_ROOT="$(dirname "$BASE_DIR")"

TARGETS=(
  "$PROJECT_ROOT/scripts"
  "$HOME/bin"
)

echo "üîß Ensuring executable bits on mrk scripts‚Ä¶"
for dir in "${TARGETS[@]}"; do
  if [ -d "$dir" ]; then
    # Only chmod top-level files in each target dir
    find "$dir" -maxdepth 1 -type f -print0 2>/dev/null \
      | xargs -0 chmod +x 2>/dev/null || true
    echo "‚úì Fixed executables in: $dir"
  else
    echo "‚ö†Ô∏è Skipping missing directory: $dir"
  fi
done

echo "‚úÖ Done."
